{% comment %}
  This section is used in the search template to render search results for
  products, articles, and pages.

  https://shopify.dev/docs/storefronts/themes/architecture/templates/search
{% endcomment %}

<div class="container py-20">
  <form action="{{ routes.search_url }}" method="get" role="search" class="flex items-center gap-2">
    <input
      id="search-input"
      type="search"
      name="q"
      value="{{ search.terms | escape }}"
      placeholder="{{ 'search.placeholder' | t }}"
      class="border border-gray-300 rounded px-4 py-2 h-16 w-full focus:outline-none focus:ring-1 focus:ring-secondary"
      autocomplete="off"
    >
    <button
      type="submit"
      class="h-[64px] w-[64px] border border-gray-300 rounded flex items-center justify-center hover:bg-secondary text-primary hover:text-white"
    >
      {% render 'icon-search' %}
    </button>
  </form>

  <div id="search-results-container" class="py-10">
    {% if search.performed %}
      <div id="search-results" class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 w-full">
        {% if search.performed %}
          {% for result in search.results %}
            {% render 'product-card', product: result %}
          {% endfor %}
        {% endif %}
      </div>
    {% else %}
      <div id="search-results" class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 w-full"></div>
    {% endif %}
  </div>
</div>

<script>
  const searchInput = document.querySelector('#search-input');
  const resultsContainer = document.querySelector('#search-results');

  searchInput.addEventListener('input', (e) => {
    const searchTerm = e.target.value.trim();

    if (searchTerm.length === 0) {
      resultsContainer.innerHTML = '';
      return;
    }

    if (searchTerm.length > 2) {
      fetch(
        `${window.Shopify.routes.root}search/suggest.json?q=${searchTerm}&resources[type]=product&resources[limit]=4`
      )
        .then((response) => response.json())
        .then((suggestions) => {
          const products = suggestions.resources.results.products; // Veri yolu burada değişti

          if (products.length > 0) {
            renderResults(products);
          } else {
            resultsContainer.innerHTML = `<p>{{ 'search.no_results' | t }}</p>`;
          }
        })
        .catch((err) => console.error('Search Error:', err));
    }
  });

  function renderResults(products) {
    resultsContainer.innerHTML = products
      .map((product) => {
        const isOnSale = product.compare_at_price > product.price;
        const hasSecondImage = product.images && product.images.length > 1;

        return `
        <div class="group flex flex-col h-full bg-white overflow-hidden relative">
          <div class="relative aspect-[3/4] overflow-hidden bg-[#F9F9F9]">
            ${
              isOnSale
                ? `
              <span class="absolute top-3 left-3 z-10 bg-[#B2AC88] text-white text-[9px] px-2 py-1 tracking-widest uppercase">
                Sale
              </span>
            `
                : ''
            }

            <a href="${product.url}" class="block h-full w-full">
              <img
                src="${product.image}"
                alt="${product.title}"
                class="w-full h-full object-cover transition-opacity duration-700 ${
                  hasSecondImage ? 'group-hover:opacity-0' : ''
                }"
              >

              ${
                hasSecondImage
                  ? `
                <img
                  src="${product.images[1]}"
                  alt="${product.title}"
                  class="w-full h-full object-cover absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-700"
                >
              `
                  : ''
              }
            </a>

            <div class="absolute inset-x-0 bottom-0 translate-y-full group-hover:translate-y-0 transition-transform duration-300 hidden md:block">
              <a
                href="${product.url}"
                class="w-full bg-[#3B443C] text-white py-3 text-[10px] uppercase tracking-[0.2em] block text-center hover:bg-[#B2AC88] transition-colors"
              >
                View Product
              </a>
            </div>
          </div>

          <div class="pt-4 pb-2 flex flex-col items-center">
            <a
              href="${product.url}"
              class="text-[#3B443C] text-xs font-light tracking-wide hover:text-[#B2AC88] transition-colors uppercase"
            >
              ${product.title}
            </a>

            <div class="mt-2 flex items-center gap-2">
              ${
                isOnSale
                  ? `
                <span class="text-gray-400 line-through text-[11px]">${
                  product.compare_at_price_format || product.compare_at_price
                }</span>
                <span class="text-[#B2AC88] text-sm font-medium">${product.price_format || product.price}</span>
              `
                  : `
                <span class="text-[#3B443C] text-sm font-light italic">${product.price_format || product.price}</span>
              `
              }
            </div>
          </div>
        </div>
      `;
      })
      .join('');
  }
</script>

{% schema %}
{
  "name": "t:general.search",
  "settings": []
}
{% endschema %}
