<section class="relative w-full py-12 px-4 md:px-10">
  <div class="container overflow-visible rounded-sm relative group">
    <div class="relative w-full aspect-[16/9] md:aspect-[21/9]">
      {% if section.settings.image != blank %}
        {{
          section.settings.image
          | image_url: width: 2500
          | image_tag: class: 'w-full h-full object-cover shadow-2xl'
        }}
      {% else %}
        {{ 'lifestyle-1' | placeholder_svg_tag: 'w-full h-full object-cover bg-gray-200' }}
      {% endif %}

      {% for block in section.blocks %}
        {%- assign product = block.settings.product -%}
        {% comment %} Yeni Shopify standartlarında handle'a gerek yok, direkt objeyi alıyoruz {% endcomment %}

        {% if product != blank %}
          <div
            class="absolute z-20 group/hotspot"
            style="top: {{ block.settings.top_position }}%; left: {{ block.settings.left_position }}%; transform: translate(-50%, -50%);"
            {{ block.shopify_attributes }}
          >
            <button class="relative flex items-center justify-center w-6 h-6 md:w-8 md:h-8 focus:outline-none">
              <span class="absolute inline-flex h-full w-full rounded-full bg-white opacity-75 animate-ping"></span>
              <span class="relative inline-flex rounded-full h-3 w-3 bg-white shadow-lg border border-line"></span>
            </button>

            {% comment %}
              'invisible' yerine sadece 'opacity-0' ve 'pointer-events-none' kullanarak
              geçişleri daha yumuşak yapalım.
            {% endcomment %}
            <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-4 w-40 md:w-48 bg-white p-3 shadow-2xl opacity-0 pointer-events-none group-hover/hotspot:opacity-100 group-hover/hotspot:pointer-events-auto transition-all duration-300 z-[60]">
              <div class="relative aspect-square mb-2 overflow-hidden bg-custombg">
                <img
                  src="{{ product.featured_media | image_url: width: 300 }}"
                  height=""
                  width=""
                  class="w-full h-full object-cover"
                >
              </div>

              <h4 class="text-[10px] uppercase tracking-widest font-medium truncate mb-1 text-primary">
                {{ product.title }}
              </h4>

              <p class="text-xs text-primary mb-2">
                {{ product.price | money }}
              </p>

              <a
                href="{{ product.url }}"
                class="block text-center text-[11px] uppercase tracking-widest border border-black py-2 hover:bg-black hover:text-white transition-colors"
              >
                {{ 'products.product.view_product' | t }}
              </a>

              <div
                class="absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-l-[6px] border-l-transparent border-r-[6px] border-r-transparent border-t-[6px] border-t-white"
              ></div>
            </div>
          </div>
        {% else %}
          {% comment %} Panelde ürün seçilmediyse hata olduğunu anlamak için geçici bir nokta koyalım {% endcomment %}
          {% if shop.preview_host %}
            <div
              class="absolute bg-red-500 w-2 h-2 rounded-full"
              style="top: {{ block.settings.top_position }}%; left: {{ block.settings.left_position }}%;"
            ></div>
          {% endif %}
        {% endif %}
      {% endfor %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Shoppable Image",
  "settings": [
    {
      "type": "image_picker",
      "id": "image",
      "label": "Lifestyle Image"
    }
  ],
  "blocks": [
    {
      "type": "product_point",
      "name": "Product Point",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Select Product"
        },
        {
          "type": "range",
          "id": "top_position",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "label": "Vertical Position (Top)",
          "default": 50
        },
        {
          "type": "range",
          "id": "left_position",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "label": "Horizontal Position (Left)",
          "default": 50
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Shoppable Image",
      "blocks": [{ "type": "product_point" }]
    }
  ]
}
{% endschema %}
